<!DOCTYPE html>
<html>
  <head>
    <title>Audiosyncrasies Spotify Sync</title>
  </head>
<body>
  <h1>audisyncrasies-spotify</h1>
  <ol>
    <li>click "start auth flow"</li>
    <li>authorize spotify</li>
    <li>copy the refresh token from the field</li>
  </ol>
  <button id="start">start auth flow</button>
  <br/>
  <input id="refresh_token" placeholder="refresh token" />
  <script type="module">
    import { SpotifyApi } from 'https://unpkg.com/@spotify/web-api-ts-sdk@1.1.2/dist/mjs/index.js';

    const port = <%= port %>;
    const spotifyClientId = "<%= spotifyClientId %>";
    const startButton = document.getElementById("start");

    startButton.addEventListener('click', () => {
      SpotifyApi.performUserAuthorization(spotifyClientId, `http://localhost:${port}`, ["playlist-modify-public"], response => {
        document.getElementById('refresh_token').value = response.refresh_token;
      });
    });
  </script>
</body>
</html>
